{% extends "base.html" %}

{% block title %}Курьеры{% endblock %}
{% block sidebar %}{% include "partials/sidebars/logistic.html" %}{% endblock %}
{% block topbar_title %}Курьеры{% endblock %}
{% block breadcrumbs %}
  <a href="/dashboard/logistic/">Кабинет логиста</a> / Курьеры
{% endblock %}

{% block content %}
  <div class="section-header">
    <h4 class="mb-0">Курьеры</h4>
  </div>

  <div class="card mb-3">
    <form method="get" class="row g-2 align-items-end">
      <div class="col-md-3">
        <label class="form-label">Статус</label>
        <select name="status" class="form-select">
          <option value="">Все</option>
          {% for value, label in status_choices %}
            <option value="{{ value }}" {% if request.GET.status == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Тип транспорта</label>
        <select name="transport" class="form-select">
          <option value="">Все</option>
          {% for t in transport_types %}
            <option value="{{ t }}" {% if request.GET.transport == t %}selected{% endif %}>{{ t }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <label class="form-label">Зона</label>
        <input type="text" name="zone" value="{{ request.GET.zone }}" class="form-control" placeholder="Напр. Центр">
      </div>
      <div class="col-md-2">
        <label class="form-label">Груз (кг)</label>
        <input type="number" step="0.01" name="min_payload" value="{{ request.GET.min_payload }}" class="form-control" placeholder="Мин.">
      </div>
      <div class="col-md-2">
        <label class="form-label">Объём (м³)</label>
        <input type="number" step="0.01" name="min_volume" value="{{ request.GET.min_volume }}" class="form-control" placeholder="Мин.">
      </div>
      <div class="col-md-3">
        <label class="form-label">Сортировка</label>
        <select name="sort" class="form-select">
          <option value="">По умолчанию</option>
          <option value="name" {% if request.GET.sort == 'name' %}selected{% endif %}>Имя (А-Я)</option>
          <option value="-name" {% if request.GET.sort == '-name' %}selected{% endif %}>Имя (Я-А)</option>
          <option value="payload" {% if request.GET.sort == 'payload' %}selected{% endif %}>Грузоподъёмность</option>
          <option value="-payload" {% if request.GET.sort == '-payload' %}selected{% endif %}>Грузоподъёмность ↓</option>
          <option value="updated" {% if request.GET.sort == 'updated' %}selected{% endif %}>Обновление гео</option>
          <option value="-updated" {% if request.GET.sort == '-updated' %}selected{% endif %}>Обновление гео ↓</option>
        </select>
      </div>
      <div class="col-md-3 d-flex gap-2">
        <button class="btn btn-primary">Применить</button>
        <a href="/logistics/couriers/" class="btn btn-outline-secondary">Сбросить</a>
      </div>
    </form>
  </div>

  <div class="card">
    <div class="table-responsive">
      <table class="table mb-0">
        <thead>
          <tr>
            <th>ФИО</th>
            <th>Телефон</th>
            <th>Активность</th>
            <th>Зона</th>
            <th>Транспорт</th>
            <th>Грузоподъёмность</th>
            <th>Объём/Габариты</th>
            <th>Геолокация</th>
          </tr>
        </thead>
        <tbody>
          {% for c in couriers %}
            <tr>
              <td>{{ c.user.full_name }}</td>
              <td>{{ c.user.phone|default:"—" }}</td>
              <td>
                <span class="badge-soft {% if c.status == 'Свободен' %}success{% elif c.status == 'В рейсе' %}primary{% else %}warn{% endif %}">
                  {{ c.get_status_display }}
                </span>
              </td>
              <td>{{ c.zone|default:"—" }}</td>
              <td>{{ c.transport_type|default:"—" }}</td>
              <td>{{ c.payload_capacity_kg|default:"—" }}</td>
              <td>
                <div class="small text-muted">Объём: {{ c.cargo_volume_m3|default:"—" }}</div>
                <div class="small text-muted">Габариты: {{ c.cargo_length_cm|default:"—" }}×{{ c.cargo_width_cm|default:"—" }}×{{ c.cargo_height_cm|default:"—" }}</div>
              </td>
              <td>
                {% if c.current_lat and c.current_lng %}
                  {{ c.current_lat }}, {{ c.current_lng }}
                  <div class="small text-muted">{{ c.location_updated_at|date:"d.m.Y H:i"|default:"" }}</div>
                {% else %}
                  —
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="8" class="text-muted">Курьеры не найдены</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
