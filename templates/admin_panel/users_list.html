{% extends "base.html" %}

{% block title %}Пользователи{% endblock %}
{% block sidebar %}{% include "partials/sidebars/admin.html" %}{% endblock %}
{% block topbar_title %}Пользователи{% endblock %}
{% block breadcrumbs %}
  <a href="/admin-panel/">Админ‑панель</a> / Пользователи
{% endblock %}

{% block content %}
  <div class="section-header">
    <h4 class="mb-0">Пользователи</h4>
    <a href="/admin-panel/users/create/" class="btn btn-primary">Создать пользователя</a>
  </div>

  <div class="card">
    <div class="table-responsive">
      <table class="table mb-0">
        <thead>
          <tr>
            <th>Логин</th>
            <th>ФИО</th>
            <th>Роли</th>
            <th>Email</th>
            <th>Активен</th>
            <th>Дата создания</th>
            <th>Действия</th>
          </tr>
        </thead>
        <tbody>
          {% for u in users %}
            <tr>
              <td>{{ u.username }}</td>
              <td>{{ u.full_name }}</td>
              <td>
                {% for r in u.roles.all %}
                  <span class="badge-soft primary">{{ r.name }}</span>
                {% empty %}
                  —
                {% endfor %}
              </td>
              <td>{{ u.email }}</td>
              <td>{{ u.is_active|yesno:"Да,Нет" }}</td>
              <td>{{ u.date_joined|date:"d.m.Y" }}</td>
              <td class="text-end">
                <a class="btn btn-sm btn-outline-secondary" href="/admin-panel/users/{{ u.id }}/edit/">Изменить</a>
                <a class="btn btn-sm btn-outline-secondary" href="/admin-panel/users/{{ u.id }}/password/">Пароль</a>
                <form method="post" action="/admin-panel/users/{{ u.id }}/toggle/" class="d-inline">
                  {% csrf_token %}
                  <button class="btn btn-sm btn-outline-secondary">
                    {% if u.is_active %}Блокировать{% else %}Разблокировать{% endif %}
                  </button>
                </form>
                <a class="btn btn-sm btn-outline-danger" href="/admin-panel/users/{{ u.id }}/delete/">Удалить</a>
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="7" class="text-muted">Пользователей нет</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
